<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Élections ESR 2025</title>
<style>
body { font-family: Arial, sans-serif; background-color: #f2f2f2; margin: 0; padding: 0; }
.container { max-width: 700px; margin: 50px auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0px 0px 10px rgba(0,0,0,0.1); }
h1, h2 { text-align: center; color: #333; }
label { display: block; margin-top: 15px; font-weight: bold; }
select, input[type="text"], input[type="email"] { width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; }
button { margin-top: 20px; width: 100%; padding: 12px; background-color: #007BFF; color: #fff; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; }
button:hover { background-color: #0056b3; }
.message { text-align: center; margin-top: 20px; font-size: 18px; color: green; }
#sondage { margin-top: 30px; background: #f9f9f9; padding: 20px; border-radius: 10px; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
th { background-color: #007BFF; color: white; }
.department-header { background-color: #0056b3; color: white; font-weight: bold; }
</style>
</head>
<body>
<div class="container">
<h1>Élections ESR 2025</h1>
<p>Chaque électeur peut voter <strong>une seule fois</strong>. Limite totale de votes : <span id="voteLimit">10</span>.</p>

<form id="voteForm">
    <label for="electeur">Nom complet :</label>
    <input type="text" id="electeur" name="electeur" required>

    <label for="email">Email ou Matricule :</label>
    <input type="email" id="email" name="email" required>

    <label for="departement">Sélectionnez le département / Directeur :</label>
    <select id="departement" name="departement" required>
        <option value="">--Choisissez--</option>
        <option value="construction">Directeur de Construction</option>
        <option value="etude_conception">Service Étude & Conception</option>
    </select>

    <div id="candidatsContainer"></div>

    <button type="submit">Valider mon vote</button>
</form>

<div class="message" id="message"></div>

<div id="sondage">
    <h2>Résultats en direct</h2>
    <p>Nombre total d'électeurs : <span id="totalElecteurs">0</span></p>
    <table>
        <thead>
            <tr>
                <th>Candidat</th>
                <th>Votes</th>
            </tr>
        </thead>
        <tbody id="resultatsTable"></tbody>
    </table>
</div>
</div>

<script>
const candidats = {
    construction: ["Ir Joël Ndona", "Ir Parfait Kukambisa", "Ir Enock Toussaint"],
    etude_conception: ["Ir Tonny Achema", "Ar Bibiane Bawota"]
};

const voteLimit = 10; // Limite totale de votes
let voteCounts = {};
for (let dept in candidats) {
    candidats[dept].forEach(c => voteCounts[c] = 0);
}

const departementSelect = document.getElementById("departement");
const candidatsContainer = document.getElementById("candidatsContainer");
const voteForm = document.getElementById("voteForm");
const messageDiv = document.getElementById("message");
const totalElecteursSpan = document.getElementById("totalElecteurs");
const resultatsTable = document.getElementById("resultatsTable");

function updateSondage() {
    let totalVotes = Object.keys(localStorage).length;
    if(totalVotes > voteLimit) totalVotes = voteLimit;
    totalElecteursSpan.textContent = totalVotes;
    resultatsTable.innerHTML = '';

    for (let dept in candidats) {
        const deptRow = document.createElement('tr');
        const deptCell = document.createElement('td');
        deptCell.textContent = dept === 'construction' ? 'Département Construction' : 'Service Étude & Conception';
        deptCell.colSpan = 2;
        deptCell.className = 'department-header';
        deptRow.appendChild(deptCell);
        resultatsTable.appendChild(deptRow);

        candidats[dept].forEach(candidat => {
            const row = document.createElement('tr');
            const nameCell = document.createElement('td');
            nameCell.textContent = candidat;
            const voteCell = document.createElement('td');
            voteCell.textContent = voteCounts[candidat];
            row.appendChild(nameCell);
            row.appendChild(voteCell);
            resultatsTable.appendChild(row);
        });
    }
}

departementSelect.addEventListener("change", function() {
    const dept = this.value;
    candidatsContainer.innerHTML = "";
    if(dept) {
        candidats[dept].forEach((candidat, index) => {
            const radio = document.createElement("input");
            radio.type = "radio";
            radio.name = "candidat";
            radio.value = candidat;
            radio.id = "candidat" + index;
            radio.required = true;

            const label = document.createElement("label");
            label.htmlFor = "candidat" + index;
            label.textContent = candidat;

            candidatsContainer.appendChild(radio);
            candidatsContainer.appendChild(label);
        });
    }
});

voteForm.addEventListener("submit", function(e) {
    e.preventDefault();

    const email = document.getElementById("email").value;
    if(Object.keys(localStorage).length >= voteLimit) {
        messageDiv.textContent = "La limite de votes a été atteinte.";
        messageDiv.style.color = "red";
        return;
    }
    if(localStorage.getItem(email)) {
        messageDiv.textContent = "Vous avez déjà voté avec cet email/matricule !";
        messageDiv.style.color = "red";
        return;
    }

    const formData = new FormData(voteForm);
    const voteData = {
        nom: formData.get("electeur"),
        email: formData.get("email"),
        departement: formData.get("departement"),
        candidat: formData.get("candidat")
    };

    localStorage.setItem(email, JSON.stringify(voteData));
    voteCounts[voteData.candidat] += 1;

    messageDiv.textContent = "Merci pour votre participation ! Votre vote a été enregistré.";
    messageDiv.style.color = "green";
    voteForm.reset();
    candidatsContainer.innerHTML = "";
    updateSondage();
});

updateSondage();
</script>
</body>
</html>
